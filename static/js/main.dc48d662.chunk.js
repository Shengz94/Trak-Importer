(this["webpackJsonptrack-importer"]=this["webpackJsonptrack-importer"]||[]).push([[0],{39:function(e,t,n){},50:function(e,t,n){"use strict";n.r(t);var r=n(0),s=n.n(r),c=n(12),a=n.n(c),i=(n(39),n(8)),o=n(14),u=n(3),l=n(64);var d=function(e){return"undefined"===e||"null"===e||""===e||"undefined"===typeof e||void 0===e||null===e},h=n(65),p=n(2),f=Object(u.g)((function(e){var t=Object(r.useState)(),n=Object(i.a)(t,2),s=n[0],c=n[1];return Object(p.jsxs)("div",{children:[Object(p.jsx)("input",{type:"file",onChange:function(e){return function(e){e.preventDefault(),c(e.target.files[0])}(e)}}),Object(p.jsx)(l.a,{disabled:d(s),onClick:function(){var t=new FileReader;t.onload=function(t){var n=t.target.result.split("\n"),r=new Map;n.forEach((function(e){if(!d(e)){var t={id:Object(h.a)(),sourceTitle:e,traktTitle:[],selected:{},import:!0};r.set(t.id,t)}})),e.populateTitles(r),e.history.push("Import-Trakt")},t.readAsText(s)},children:"Process titles"})]})})),j=n(31),b=n(19),m=n.n(b),O=n(26),v=n(33),x=function(e){return Object(p.jsxs)("div",{className:"title-import-card",children:[Object(p.jsx)("div",{className:"checkbox-import",children:Object(p.jsx)("input",{type:"checkbox",checked:e.title.import,onChange:function(){return e.handleImportCheckBox(e.title.id)}})}),Object(p.jsx)("div",{className:"source-name",children:Object(p.jsxs)("span",{children:["Input title: ",e.title.sourceTitle]})}),Object(p.jsx)("div",{className:"trakt-title",children:d(e.title.selected)?Object(p.jsx)("span",{children:"No title found on Trakt"}):Object(p.jsxs)("label",{children:["Trakt title:",Object(p.jsx)("select",{value:d(e.title.selected)?"":JSON.stringify(e.title.selected),onChange:function(t){return e.handleSelectedChange(e.title.id,t.target.value)},children:e.title.traktTitle.map((function(e){return Object(p.jsx)("option",{value:JSON.stringify(e),children:"Trakt ID "+e.id+": "+e.title+" - "+e.year+" ("+e.type+")"},e.id)}))})]})})]})},k=n(32),g="3f2a4833bca232c1afbb66c2a56447e7d75b44372af9d45f11cf0b907b326b92",T="https://api.trakt.tv/",y="https://shengz94.github.io/trakt-history-importer/";function w(e){var t=T+"search/movie,show?query="+encodeURI(e);return fetch(t,{headers:{"Content-Type":"application/json","trakt-api-key":g,"trakt-api-version":"2"},method:"get"}).then((function(e){return e.json()})).then((function(e){var t=[];return e.forEach((function(e){var n="movie"===e.type?e.movie:e.show,r={type:e.type,title:n.title,year:n.year,id:n.ids.trakt,slug:n.ids.slug};t.push(r)})),t}))}function S(e,t,n){var r=t+"s",s=Object(k.a)({},r,[{ids:{trakt:e}}]),c={headers:{"Content-Type":"application/json","trakt-api-key":g,"trakt-api-version":"2",Authorization:"Bearer "+n},body:JSON.stringify(s),method:"post"};return fetch("https://api.trakt.tv/sync/history/",c).then((function(e){return e.json()})).then((function(e){var t={added:{movies:e.added.movies,episodes:e.added.episodes},notFound:{movies:[],shows:[],seasons:[],episodes:[]}};return e.not_found.movies.forEach((function(e){t.notFound.movies.push(e)})),e.not_found.shows.forEach((function(e){t.notFound.shows.push(e)})),e.not_found.seasons.forEach((function(e){t.notFound.seasons.push(e)})),e.not_found.episodes.forEach((function(e){t.notFound.episodes.push(e)})),t}))}function _(e){return fetch("https://api.trakt.tv/users/settings/",{headers:{"Content-Type":"application/json","trakt-api-key":g,"trakt-api-version":"2",Authorization:"Bearer "+e},method:"get"}).then((function(e){return e.json()})).then((function(e){return{username:e.user.username,name:e.user.name,uuid:e.user.ids.uuid,slug:e.user.ids.slug,image:e.user.images.avatar.full}}))}var C=Object(u.g)((function(e){var t=Object(r.useState)(!1),n=Object(i.a)(t,2),s=n[0],c=n[1],a=Object(r.useState)(),o=Object(i.a)(a,2),u=o[0],h=o[1];function f(){return(f=Object(O.a)(m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],e.titles.forEach((function(e){var t=e;n.push(w(t.sourceTitle))})),t.next=4,Promise.allSettled(n).then((function(t){e.updateTitles(t)}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(){return(b=Object(O.a)(m.a.mark((function t(){var n,r,s,c,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d(e.titles)){t.next=27;break}n=[],s=Object(j.a)(e.titles.values()),t.prev=3,s.s();case 5:if((c=s.n()).done){t.next=13;break}if(!(a=c.value).import||d(a.selected)||d(a.selected.id)){t.next=11;break}return n.push(S(a.selected.id,a.selected.type,e.userToken)),t.next=11,new Promise((function(e){return setTimeout(e,1e3)}));case 11:t.next=5;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(3),s.e(t.t0);case 18:return t.prev=18,s.f(),t.finish(18);case 21:return t.next=24,Promise.allSettled(n).then((function(e){d(e)||(r=e)}));case 24:console.log(r),e.fillLog(r),e.history.push("/Result");case 27:case"end":return t.stop()}}),t,null,[[3,15,18,21]])})))).apply(this,arguments)}return Object(r.useEffect)((function(){!function(){f.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){h(Object(v.a)(e.titles.values()))}),[e.titles]),Object(r.useEffect)((function(){!d(u)&&u.length>=0&&c(!0)}),[u]),(d(e.titles)||e.titles.size<=0)&&e.history.push("home"),Object(p.jsx)("div",{className:"title-list",children:s&&!d(e.titles)?Object(p.jsxs)(r.Fragment,{children:[u.map((function(t){return Object(p.jsx)(x,{title:t,updateTitle:e.updateTitle,handleImportCheckBox:e.handleImportCheckBox,handleSelectedChange:e.handleSelectedChange},t.id)})),Object(p.jsx)(l.a,{onClick:function(){return b.apply(this,arguments)},children:"Import titles"})]}):Object(p.jsx)(r.Fragment,{})})})),N=Object(u.g)((function(e){var t=T+"oauth/authorize/?client_id="+g+"&redirect_uri="+encodeURI(y)+"&response_type=code";return Object(p.jsx)("div",{children:Object(p.jsx)(l.a,{size:"small",variant:"contained",onClick:function(){window.location.href=t},children:"Log in"})})})),I=function(e){var t=Object(r.useState)(!1),n=Object(i.a)(t,2),s=(n[0],n[1]);return Object(r.useEffect)((function(){!d(e.log)&&e.log.length>0&&s(!0)}),[e.log]),Object(p.jsx)("div",{className:"result-view",children:Object(p.jsx)("div",{className:"log",children:e.log.map((function(e){return function(e){if(e.indexOf("///end///")>0){var t=e.split("///end///"),n=t[1],r=t[0].split("///startTitle///"),s=r[0],c=r[1];return Object(p.jsxs)("p",{children:[s," ",Object(p.jsx)("a",{href:n,children:c})," "]},Math.random())}return e}(e)}))})})},E=function(e){return Object(p.jsx)("div",{className:"top-bar",children:d(e.user)?Object(p.jsx)(r.Fragment,{}):Object(p.jsxs)("div",{className:"user-info",children:[Object(p.jsx)("div",{className:"user-avatar",children:Object(p.jsx)("img",{src:e.user.image})}),Object(p.jsx)("div",{className:"user-name",children:Object(p.jsx)("span",{children:e.user.username})}),Object(p.jsx)("div",{className:"logout",children:Object(p.jsx)(l.a,{onClick:e.logout,children:"Log out"})})]})})},F=function(e){var t=Object(r.useState)(new Map),n=Object(i.a)(t,2),s=n[0],c=n[1],a=Object(r.useState)([]),l=Object(i.a)(a,2),h=l[0],j=l[1],b=Object(r.useState)(),m=Object(i.a)(b,2),O=m[0],v=m[1],x=Object(r.useState)(localStorage.getItem("userToken")),k=Object(i.a)(x,2),T=k[0],w=k[1];function S(e,t){var n=new Map(s);n.set(e,t),c(n)}function F(e){var t=new Map(s),n=0;t.forEach((function(t){t.traktTitle=e[n].value,d(e[n])||(t.selected=e[n].value[0]),n++})),c(t)}function z(e,t){var n=s.get(e);n.selected=JSON.parse(t),S(e,n)}function B(e){var t=s.get(e);t.import=!t.import,S(e,t)}function R(e){var t=0,n=[];s.forEach((function(r){var s="-";r.import?d(r.selected)?s=r.sourceTitle+" NOT found in Trakt. ":(console.log(e),s=!d(e[t])&&"fulfilled"===e[t].status&&("movie"===r.selected.type&&e[t].value.added.movies>0||"show"===r.selected.type&&e[t].value.added.episodes>0)?r.sourceTitle+" imported to Trakt as ///startTitle///"+r.selected.title+" - "+r.selected.year+"("+r.selected.type+") (ID:"+r.selected.id+"). ///end///https://trakt.tv/"+r.selected.type+"s/"+r.selected.slug:"There were a problem importing "+r.sourceTitle+" to Trakt. "):s=r.sourceTitle+" NOT imported to Trakt. ",t++,n.push(s)})),j(n)}return Object(r.useEffect)((function(){localStorage.setItem("userToken",T)}),[T]),Object(r.useEffect)((function(){if(console.log("User Token: "+T),d(T)){var e=new URLSearchParams(window.location.search).get("code");console.log("User code: "+e),d(e)||function(e){var t=new URLSearchParams;return t.append("code",e),t.append("client_id",g),t.append("client_secret","ea9ac4d176818616f44dc3a3d643cf73569590ae0c055d2dc190023d9762ea81"),t.append("redirect_uri",y),t.append("grant_type","authorization_code"),fetch("https://api.trakt.tv/oauth/token/",{header:{"Content-Type":"application/json"},body:t,method:"post"}).then((function(e){return e.json()})).then((function(e){return{access_token:e.access_token,expireIn:e.expires_in,refreshToken:e.refresh_token,created_at:e.created_at}}))}(e).then((function(e){w(e.access_token),_(e.access_token).then((function(e){v(e)}))}))}else _(T).then((function(e){v(e)}))}),[]),Object(p.jsxs)(r.Fragment,{children:[Object(p.jsx)(E,{user:O,logout:function(){localStorage.removeItem("userToken"),v(void 0)}}),Object(p.jsx)(o.a,{basename:"/Trakt-Importer",children:Object(p.jsxs)(u.d,{children:[Object(p.jsx)(u.b,{exact:!0,path:"/",children:d(T)?Object(p.jsx)(N,{}):Object(p.jsx)(u.a,{to:"Home"})}),Object(p.jsx)(u.b,{exact:!0,path:"/Home",children:Object(p.jsx)(f,{populateTitles:function(e){return function(e){c(e)}(e)}})}),Object(p.jsx)(u.b,{exact:!0,path:"/Import-Trakt",render:function(){return Object(p.jsx)(C,{titles:s,userToken:T,log:h,updateTitles:F,fillLog:R,handleSelectedChange:z,handleImportCheckBox:B})}}),Object(p.jsx)(u.b,{exact:!0,path:"/Result",render:function(){return Object(p.jsx)(I,{log:h})}})]})})]})};a.a.render(Object(p.jsx)(s.a.StrictMode,{children:Object(p.jsx)(F,{})}),document.getElementById("root"))}},[[50,1,2]]]);
//# sourceMappingURL=main.dc48d662.chunk.js.map